<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - MyWebsites</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #405DE6;
            --secondary-color: #5851DB;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }
        
        .menu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .menu-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .menu-item.active {
            background-color: rgba(255,255,255,0.2);
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            margin: 2px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, 
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            min-height: 150px;
        }
        
        .logout-btn {
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            margin: 0;
            font-size: 24px;
            color: var(--primary-color);
        }
        
        .stat-card p {
            margin: 5px 0 0;
            color: #666;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            margin-top: 10px;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
                <p>Welcome, <span id="adminName">Admin</span></p>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-section="websites">
                    <i class="fas fa-globe"></i>
                    <span>Manage Websites</span>
                </div>
                <div class="menu-item" data-section="blogs">
                    <i class="fas fa-blog"></i>
                    <span>Manage Blogs</span>
                </div>
                <div class="menu-item" data-section="help-requests">
                    <i class="fas fa-question-circle"></i>
                    <span>Help Requests</span>
                </div>
                <div class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection">
                <div class="header">
                    <h2>Dashboard Overview</h2>
                    <div>
                        <button class="btn btn-primary" id="addWebsiteBtn">
                            <i class="fas fa-plus"></i> Add Website
                        </button>
                        <button class="btn btn-success" id="addBlogBtn" style="margin-left: 10px;">
                            <i class="fas fa-plus"></i> Add Blog
                        </button>
                    </div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <h3 id="totalWebsites">0</h3>
                        <p>Total Websites</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalBlogs">0</h3>
                        <p>Total Blogs</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="pendingRequests">0</h3>
                        <p>Pending Help Requests</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="resolvedRequests">0</h3>
                        <p>Resolved Requests</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity">
                        Loading recent activity...
                    </div>
                </div>
            </div>
            
            <!-- Websites Section -->
            <div id="websitesSection" style="display: none;">
                <div class="header">
                    <h2>Manage Websites</h2>
                    <button class="btn btn-primary" id="addNewWebsiteBtn">
                        <i class="fas fa-plus"></i> Add New Website
                    </button>
                </div>
                
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>URL</th>
                                <th>Added On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="websitesTable">
                            <!-- Websites will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Blogs Section -->
            <div id="blogsSection" style="display: none;">
                <div class="header">
                    <h2>Manage Blog Posts</h2>
                    <button class="btn btn-primary" id="addNewBlogBtn">
                        <i class="fas fa-plus"></i> Add New Blog Post
                    </button>
                </div>
                
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Published On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blogsTable">
                            <!-- Blogs will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Help Requests Section -->
            <div id="helpRequestsSection" style="display: none;">
                <div class="header">
                    <h2>Help Requests</h2>
                    <div>
                        <select id="requestFilter" style="padding: 8px; border-radius: 4px;">
                            <option value="all">All Requests</option>
                            <option value="new">New</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                        </select>
                    </div>
                </div>
                
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Message</th>
                                <th>Status</th>
                                <th>Received On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="helpRequestsTable">
                            <!-- Help requests will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div id="settingsSection" style="display: none;">
                <div class="header">
                    <h2>Settings</h2>
                </div>
                
                <div class="card">
                    <h3>Change Password</h3>
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Password</button>
                    </form>
                </div>
            </div>
            
            <!-- Add/Edit Website Modal -->
            <div id="websiteModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2 id="websiteModalTitle">Add New Website</h2>
                    <form id="websiteForm">
                        <input type="hidden" id="websiteId">
                        <div class="form-group">
                            <label for="websiteTitle">Website Title</label>
                            <input type="text" id="websiteTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="websiteUrl">Website URL</label>
                            <input type="url" id="websiteUrl" required>
                        </div>
                        <div class="form-group">
                            <label for="websiteDescription">Description</label>
                            <textarea id="websiteDescription" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="websiteImage">Thumbnail Image</label>
                            <input type="file" id="websiteImage" accept="image/*">
                            <div id="imagePreviewContainer">
                                <img id="imagePreview" class="image-preview" style="display: none;">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Website</button>
                    </form>
                </div>
            </div>
            
            <!-- Add/Edit Blog Modal -->
            <div id="blogModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2 id="blogModalTitle">Add New Blog Post</h2>
                    <form id="blogForm">
                        <input type="hidden" id="blogId">
                        <div class="form-group">
                            <label for="blogTitle">Blog Title</label>
                            <input type="text" id="blogTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="blogContent">Content</label>
                            <textarea id="blogContent" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="blogImage">Featured Image</label>
                            <input type="file" id="blogImage" accept="image/*">
                            <div id="blogImagePreviewContainer">
                                <img id="blogImagePreview" class="image-preview" style="display: none;">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Publish Blog</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
    <script>
        // Firebase configuration (same as your main website)
        const firebaseConfig = {
    apiKey: "AIzaSyCgswS8AZObwKQjxZooWWJHf4b1m1rvorA",
    authDomain: "t2upload.firebaseapp.com",
    databaseURL: "https://t2upload-default-rtdb.firebaseio.com",
    projectId: "t2upload",
    storageBucket: "t2upload.appspot.com",
    messagingSenderId: "1000887477924",
    appId: "1:1000887477924:web:522232d054b9b7ce2ea831",
    measurementId: "G-75ZZL6BWVH"
};
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
        const auth = firebase.auth();
        
        // DOM Elements
        const websiteModal = document.getElementById('websiteModal');
        const blogModal = document.getElementById('blogModal');
        const websiteForm = document.getElementById('websiteForm');
        const blogForm = document.getElementById('blogForm');
        
        // Check authentication state
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                document.getElementById('adminName').textContent = user.email;
                loadDashboardStats();
                loadWebsites();
                loadBlogs();
                loadHelpRequests();
            } else {
                // No user is signed in
                window.location.href = "index.html"; // Redirect to main page
            }
        });
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = "index.html";
            });
        });
        
        // Menu navigation
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', () => {
                // Remove active class from all items
                document.querySelectorAll('.menu-item').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Add active class to clicked item
                item.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('#dashboardSection, #websitesSection, #blogsSection, #helpRequestsSection, #settingsSection').forEach(section => {
                    section.style.display = 'none';
                });
                
                // Show selected section
                const sectionId = item.getAttribute('data-section') + 'Section';
                document.getElementById(sectionId).style.display = 'block';
            });
        });
        
        // Load dashboard statistics
        function loadDashboardStats() {
            // Total websites
            database.ref('websites').once('value').then(snapshot => {
                document.getElementById('totalWebsites').textContent = snapshot.numChildren();
            });
            
            // Total blogs
            database.ref('blogPosts').once('value').then(snapshot => {
                document.getElementById('totalBlogs').textContent = snapshot.numChildren();
            });
            
            // Help requests
            database.ref('helpRequests').once('value').then(snapshot => {
                let pending = 0;
                let resolved = 0;
                
                snapshot.forEach(child => {
                    if (child.val().status === 'resolved') {
                        resolved++;
                    } else {
                        pending++;
                    }
                });
                
                document.getElementById('pendingRequests').textContent = pending;
                document.getElementById('resolvedRequests').textContent = resolved;
            });
            
            // Recent activity
            database.ref('helpRequests').orderByChild('createdAt').limitToLast(5).once('value').then(snapshot => {
                let html = '<ul style="list-style-type: none; padding: 0;">';
                
                snapshot.forEach(child => {
                    const request = child.val();
                    html += `
                        <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                            <strong>${request.subject}</strong><br>
                            <small>${new Date(request.createdAt).toLocaleString()}</small>
                        </li>
                    `;
                });
                
                html += '</ul>';
                document.getElementById('recentActivity').innerHTML = html;
            });
        }
        
        // Load websites for management
        function loadWebsites() {
            database.ref('websites').once('value').then(snapshot => {
                let html = '';
                
                snapshot.forEach(child => {
                    const website = child.val();
                    html += `
                        <tr>
                            <td>${website.title}</td>
                            <td><a href="${website.url}" target="_blank">${website.url}</a></td>
                            <td>${new Date(website.createdAt).toLocaleDateString()}</td>
                            <td class="action-buttons">
                                <button class="btn btn-warning" onclick="editWebsite('${child.key}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger" onclick="deleteWebsite('${child.key}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                document.getElementById('websitesTable').innerHTML = html || '<tr><td colspan="4">No websites found</td></tr>';
            });
        }
        
        // Load blogs for management
        function loadBlogs() {
            database.ref('blogPosts').once('value').then(snapshot => {
                let html = '';
                
                snapshot.forEach(child => {
                    const blog = child.val();
                    html += `
                        <tr>
                            <td>${blog.title}</td>
                            <td>${new Date(blog.createdAt).toLocaleDateString()}</td>
                            <td class="action-buttons">
                                <button class="btn btn-warning" onclick="editBlog('${child.key}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger" onclick="deleteBlog('${child.key}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                document.getElementById('blogsTable').innerHTML = html || '<tr><td colspan="3">No blogs found</td></tr>';
            });
        }
        
        // Load help requests
        function loadHelpRequests() {
            const filter = document.getElementById('requestFilter').value;
            let ref = database.ref('helpRequests').orderByChild('createdAt');
            
            ref.once('value').then(snapshot => {
                let html = '';
                
                snapshot.forEach(child => {
                    const request = child.val();
                    
                    if (filter === 'all' || request.status === filter) {
                        html += `
                            <tr>
                                <td>${request.subject}</td>
                                <td>${request.message.substring(0, 50)}...</td>
                                <td>
                                    <select onchange="updateRequestStatus('${child.key}', this.value)" style="padding: 5px;">
                                        <option value="new" ${request.status === 'new' ? 'selected' : ''}>New</option>
                                        <option value="in-progress" ${request.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                        <option value="resolved" ${request.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                                    </select>
                                </td>
                                <td>${new Date(request.createdAt).toLocaleString()}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="deleteRequest('${child.key}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }
                });
                
                document.getElementById('helpRequestsTable').innerHTML = html || '<tr><td colspan="5">No requests found</td></tr>';
            });
        }
        
        // Filter help requests
        document.getElementById('requestFilter').addEventListener('change', loadHelpRequests);
        
        // Delete website
        window.deleteWebsite = function(websiteId) {
            if (confirm('Are you sure you want to delete this website?')) {
                database.ref('websites/' + websiteId).remove()
                    .then(() => {
                        alert('Website deleted successfully');
                        loadWebsites();
                        loadDashboardStats();
                    })
                    .catch(error => {
                        alert('Error deleting website: ' + error.message);
                    });
            }
        };
        
        // Edit website
        window.editWebsite = function(websiteId) {
            database.ref('websites/' + websiteId).once('value').then(snapshot => {
                const website = snapshot.val();
                
                // Set modal title
                document.getElementById('websiteModalTitle').textContent = 'Edit Website';
                
                // Fill form with existing data
                document.getElementById('websiteId').value = websiteId;
                document.getElementById('websiteTitle').value = website.title;
                document.getElementById('websiteUrl').value = website.url;
                document.getElementById('websiteDescription').value = website.description || '';
                
                // Show image preview if exists
                const imagePreview = document.getElementById('imagePreview');
                if (website.imageUrl) {
                    imagePreview.src = website.imageUrl;
                    imagePreview.style.display = 'block';
                } else {
                    imagePreview.style.display = 'none';
                }
                
                // Open modal
                websiteModal.style.display = 'block';
            });
        };
        
        // Delete blog
        window.deleteBlog = function(blogId) {
            if (confirm('Are you sure you want to delete this blog post?')) {
                database.ref('blogPosts/' + blogId).remove()
                    .then(() => {
                        alert('Blog post deleted successfully');
                        loadBlogs();
                        loadDashboardStats();
                    })
                    .catch(error => {
                        alert('Error deleting blog: ' + error.message);
                    });
            }
        };
        
        // Edit blog
        window.editBlog = function(blogId) {
            database.ref('blogPosts/' + blogId).once('value').then(snapshot => {
                const blog = snapshot.val();
                
                // Set modal title
                document.getElementById('blogModalTitle').textContent = 'Edit Blog Post';
                
                // Fill form with existing data
                document.getElementById('blogId').value = blogId;
                document.getElementById('blogTitle').value = blog.title;
                document.getElementById('blogContent').value = blog.content;
                
                // Show image preview if exists
                const blogImagePreview = document.getElementById('blogImagePreview');
                if (blog.imageUrl) {
                    blogImagePreview.src = blog.imageUrl;
                    blogImagePreview.style.display = 'block';
                } else {
                    blogImagePreview.style.display = 'none';
                }
                
                // Open modal
                blogModal.style.display = 'block';
            });
        };
        
        // Delete help request
        window.deleteRequest = function(requestId) {
            if (confirm('Are you sure you want to delete this help request?')) {
                database.ref('helpRequests/' + requestId).remove()
                    .then(() => {
                        alert('Request deleted successfully');
                        loadHelpRequests();
                        loadDashboardStats();
                    });
            }
        };
        
        // Update request status
        window.updateRequestStatus = function(requestId, status) {
            database.ref('helpRequests/' + requestId).update({
                status: status
            }).then(() => {
                loadDashboardStats();
            });
        };
        
        // Modal functionality
        
        // Open add website modal
        document.getElementById('addNewWebsiteBtn').addEventListener('click', () => {
            document.getElementById('websiteModalTitle').textContent = 'Add New Website';
            document.getElementById('websiteId').value = '';
            websiteForm.reset();
            document.getElementById('imagePreview').style.display = 'none';
            websiteModal.style.display = 'block';
        });
        
        // Open add blog modal
        document.getElementById('addNewBlogBtn').addEventListener('click', () => {
            document.getElementById('blogModalTitle').textContent = 'Add New Blog Post';
            document.getElementById('blogId').value = '';
            blogForm.reset();
            document.getElementById('blogImagePreview').style.display = 'none';
            blogModal.style.display = 'block';
        });
        
        // Close modals when clicking X
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.addEventListener('click', () => {
                websiteModal.style.display = 'none';
                blogModal.style.display = 'none';
            });
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === websiteModal) {
                websiteModal.style.display = 'none';
            }
            if (e.target === blogModal) {
                blogModal.style.display = 'none';
            }
        });
        
        // Image preview for website
        document.getElementById('websiteImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imagePreview = document.getElementById('imagePreview');
                    imagePreview.src = event.target.result;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Image preview for blog
        document.getElementById('blogImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const blogImagePreview = document.getElementById('blogImagePreview');
                    blogImagePreview.src = event.target.result;
                    blogImagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Save website (add or update)
        websiteForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const websiteId = document.getElementById('websiteId').value;
            const title = document.getElementById('websiteTitle').value;
            const url = document.getElementById('websiteUrl').value;
            const description = document.getElementById('websiteDescription').value;
            const imageFile = document.getElementById('websiteImage').files[0];
            
            if (imageFile) {
                // Upload image first
                const storageRef = storage.ref('website-images/' + Date.now() + '-' + imageFile.name);
                const uploadTask = storageRef.put(imageFile);
                
                uploadTask.on('state_changed', 
                    (snapshot) => {
                        // Progress monitoring can be added here
                    }, 
                    (error) => {
                        alert('Error uploading image: ' + error.message);
                    }, 
                    () => {
                        // Upload completed
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            saveWebsite(websiteId, title, url, description, downloadURL);
                        });
                    }
                );
            } else {
                // If editing and no new image selected, keep existing image
                const imagePreview = document.getElementById('imagePreview');
                const imageUrl = imagePreview.style.display === 'none' ? null : imagePreview.src;
                saveWebsite(websiteId, title, url, description, imageUrl);
            }
        });
        
        function saveWebsite(websiteId, title, url, description, imageUrl) {
            const websiteData = {
                title,
                url,
                description,
                imageUrl,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            if (websiteId) {
                // Update existing website
                database.ref('websites/' + websiteId).update(websiteData)
                    .then(() => {
                        alert('Website updated successfully');
                        websiteModal.style.display = 'none';
                        loadWebsites();
                        loadDashboardStats();
                    })
                    .catch(error => {
                        alert('Error updating website: ' + error.message);
                    });
            } else {
                // Add new website
                database.ref('websites').push(websiteData)
                    .then(() => {
                        alert('Website added successfully');
                        websiteModal.style.display = 'none';
                        loadWebsites();
                        loadDashboardStats();
                    })
                    .catch(error => {
                        alert('Error adding website: ' + error.message);
                    });
            }
        }
        
        // Save blog (add or update)
        blogForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const blogId = document.getElementById('blogId').value;
            const title = document.getElementById('blogTitle').value;
            const content = document.getElementById('blogContent').value;
            const imageFile = document.getElementById('blogImage').files[0];
            
            if (imageFile) {
                // Upload image first
                const storageRef = storage.ref('blog-images/' + Date.now() + '-' + imageFile.name);
                const uploadTask = storageRef.put(imageFile);
                
                uploadTask.on('state_changed', 
                    (snapshot) => {
                        // Progress monitoring can be added here
                    }, 
                    (error) => {
                        alert('Error uploading image: ' + error.message);
                    }, 
                    () => {
                        // Upload completed
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            saveBlog(blogId, title, content, downloadURL);
                        });
                    }
                );
            } else {
                // If editing and no new image selected, keep existing image
                const blogImagePreview = document.getElementById('blogImagePreview');
                const imageUrl = blogImagePreview.style.display === 'none' ? null : blogImagePreview.src;
                saveBlog(blogId, title, content, imageUrl);
            }
        });
        
        function saveBlog(blogId, title, content, imageUrl) {
            const blogData = {
                title,
                content,
                imageUrl,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            if (blogId) {
                // Update existing blog
                database.ref('blogPosts/' + blogId).update(blogData)
                    .then(() => {
                        alert('Blog post updated successfully');
                        blogModal.style.display = 'none';
                        loadBlogs();
                        loadDashboardStats();
                    })
                    .catch(error => {
                        alert('Error updating blog: ' + error.message);
                    });
            } else {
                // Add new blog
                database.ref('blogPosts').push(blogData)
                    .then(() => {
                        alert('Blog post published successfully');
                        blogModal.style.display = 'none';
                        loadBlogs();
                        loadDashboardStats();
                    })
                    .catch(error => {
                        alert('Error publishing blog: ' + error.message);
                    });
            }
        }
        
        // Change password
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            const user = auth.currentUser;
            const credential = firebase.auth.EmailAuthProvider.credential(
                user.email, 
                currentPassword
            );
            
            // Reauthenticate user
            user.reauthenticateWithCredential(credential)
                .then(() => {
                    // Change password
                    return user.updatePassword(newPassword);
                })
                .then(() => {
                    alert('Password changed successfully');
                    document.getElementById('changePasswordForm').reset();
                })
                .catch(error => {
                    alert('Error changing password: ' + error.message);
                });
        });
    </script>
</body>
</html>