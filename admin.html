<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }
    header {
      background-color: #333;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    input, textarea {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 16px;
      margin: 10px 5px 20px 0;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    img {
      width: 100px;
      border-radius: 6px;
      margin-top: 10px;
    }
    .stats {
      font-weight: bold;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h2>Admin Panel</h2>
  </header>
  <div class="container">
    <h3>Upload New Website</h3>
    <input type="text" id="siteName" placeholder="Website Name">
    <textarea id="siteDesc" placeholder="Website Description"></textarea>
    <input type="text" id="siteURL" placeholder="Website URL">
    <input type="file" id="siteImage">
    <button onclick="uploadSite()">Upload</button>

    <div class="stats">Total Websites: <span id="count">0</span></div>
    <div id="adminList"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyCgswS8AZObwKQjxZooWWJHf4b1m1rvorA",
  authDomain: "t2upload.firebaseapp.com",
  databaseURL: "https://t2upload-default-rtdb.firebaseio.com",
  projectId: "t2upload",
  storageBucket: "t2upload.appspot.com",
  messagingSenderId: "1000887477924",
  appId: "1:1000887477924:web:522232d054b9b7ce2ea831",
  measurementId: "G-75ZZL6BWVH"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    const siteName = document.getElementById('siteName');
    const siteDesc = document.getElementById('siteDesc');
    const siteURL = document.getElementById('siteURL');
    const siteImage = document.getElementById('siteImage');
    const adminList = document.getElementById('adminList');
    const countDisplay = document.getElementById('count');

    function uploadSite() {
      const file = siteImage.files[0];
      const ref = storage.ref('siteImages/' + file.name);
      ref.put(file).then(snapshot => {
        ref.getDownloadURL().then(url => {
          const newRef = db.ref('websites').push();
          newRef.set({
            name: siteName.value,
            description: siteDesc.value,
            url: siteURL.value,
            imageURL: url,
            timestamp: Date.now()
          });
          siteName.value = '';
          siteDesc.value = '';
          siteURL.value = '';
          siteImage.value = '';
        });
      });
    }

    function renderAdminSite(key, data) {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <p><b>${data.name}</b></p>
        <p>${data.description}</p>
        <img src="${data.imageURL}" id="img-${key}"><br>
        <input type="file" onchange="updateImage(event, '${key}')">
        <button onclick="deleteSite('${key}')">Delete</button>
        <button onclick="editSite('${key}', '${data.name}', '${data.description}', '${data.url}')">Edit</button>
      `;
      return div;
    }

    function loadAdminSites() {
      adminList.innerHTML = '';
      db.ref('websites').orderByChild('timestamp').on('value', snapshot => {
        const children = [];
        snapshot.forEach(child => children.push(child));
        children.reverse().forEach(child => {
          const key = child.key;
          const data = child.val();
          const div = renderAdminSite(key, data);
          adminList.appendChild(div);
        });
        countDisplay.innerText = children.length;
      });
    }

    function deleteSite(key) {
      db.ref('websites/' + key).remove();
    }

    function editSite(key, name, desc, url) {
      const newName = prompt('Edit name:', name);
      const newDesc = prompt('Edit description:', desc);
      const newURL = prompt('Edit URL:', url);
      if (newName && newDesc && newURL) {
        db.ref('websites/' + key).update({
          name: newName,
          description: newDesc,
          url: newURL
        });
      }
    }

    function updateImage(event, key) {
      const file = event.target.files[0];
      if (!file) return;
      const ref = storage.ref('siteImages/' + file.name);
      ref.put(file).then(snapshot => {
        ref.getDownloadURL().then(url => {
          db.ref('websites/' + key).update({ imageURL: url });
          document.getElementById('img-' + key).src = url;
        });
      });
    }

    loadAdminSites();
  </script>
</body>
</html>
